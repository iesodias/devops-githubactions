name: Steps Condicionais

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:
    inputs:
      run_tests:
        description: 'Executar testes?'
        required: false
        default: true
        type: boolean
      deploy_environment:
        description: 'Ambiente para deploy'
        required: false
        default: 'none'
        type: choice
        options:
        - none
        - development
        - staging
        - production

jobs:
  conditional-steps:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout cÃ³digo
      uses: actions/checkout@v4
    
    - name: Step sempre executado
      run: |
        echo "ğŸ“‹ Este step sempre executa"
        echo "ğŸ¯ Evento: ${{ github.event_name }}"
        echo "ğŸŒ¿ Branch: ${{ github.ref_name }}"
    
    - name: Step apenas em push
      if: github.event_name == 'push'
      run: |
        echo "ğŸ“¤ Este step executa apenas em PUSH"
        echo "ğŸ“ Commit: ${{ github.sha }}"
    
    - name: Step apenas em PR
      if: github.event_name == 'pull_request'
      run: |
        echo "ğŸ”€ Este step executa apenas em PULL REQUEST"
        echo "ğŸ“ PR #${{ github.event.number }}"
    
    - name: Step apenas na main
      if: github.ref == 'refs/heads/main'
      run: |
        echo "ğŸ¯ Este step executa apenas na branch MAIN"
    
    - name: Executar testes (input manual)
      if: github.event.inputs.run_tests == 'true' || github.event_name != 'workflow_dispatch'
      run: |
        echo "ğŸ§ª Executando testes..."
        sleep 2
        echo "âœ… Testes concluÃ­dos"
    
    - name: Deploy para Development
      if: github.event.inputs.deploy_environment == 'development'
      run: |
        echo "ğŸš€ Deploy para DEVELOPMENT"
        sleep 1
        echo "âœ… Deploy concluÃ­do"
    
    - name: Deploy para Staging
      if: github.event.inputs.deploy_environment == 'staging'
      run: |
        echo "ğŸš€ Deploy para STAGING"
        sleep 2
        echo "âœ… Deploy concluÃ­do"
    
    - name: Deploy para Production
      if: github.event.inputs.deploy_environment == 'production'
      run: |
        echo "ğŸš€ Deploy para PRODUCTION"
        echo "âš ï¸ Aguardando aprovaÃ§Ã£o manual..."
        sleep 3
        echo "âœ… Deploy concluÃ­do"
    
    - name: Step com mÃºltiplas condiÃ§Ãµes
      if: github.event_name == 'push' && github.ref == 'refs/heads/main' && success()
      run: |
        echo "ğŸ¯ Push na main com sucesso nos steps anteriores"
    
    - name: Step que executa mesmo com falha
      if: always()
      run: |
        echo "ğŸ”„ Este step sempre executa, mesmo se houver falhas"
        echo "ğŸ“Š Status dos jobs anteriores: ${{ job.status }}"
    
    - name: Step apenas se houver falha
      if: failure()
      run: |
        echo "âŒ Este step executa apenas se houver falha"
    
    - name: Cleanup
      if: always()
      run: |
        echo "ğŸ§¹ Limpeza final sempre executada"